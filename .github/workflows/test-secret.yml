name: Testar Secret GOOGLE_API_KEY

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  test-secret:
    name: Verificar API Key Secret
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout código
      uses: actions/checkout@v4
      
    - name: Verificar se secret existe
      run: |
        echo "🔍 Verificando se GOOGLE_API_KEY está configurado..."
        if [ -z "$GOOGLE_API_KEY" ]; then
          echo "❌ GOOGLE_API_KEY não está definido"
          exit 1
        else
          echo "✅ GOOGLE_API_KEY está definido!"
          echo "📏 Tamanho da chave: ${#GOOGLE_API_KEY} caracteres"
          echo "🔑 Primeiros 4 caracteres: ${GOOGLE_API_KEY:0:4}..."
          echo "🔑 Últimos 4 caracteres: ...${GOOGLE_API_KEY: -4}"
        fi
      env:
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        
    - name: Testar formato da API key
      run: |
        echo "🔍 Testando formato da API key..."
        if echo "$GOOGLE_API_KEY" | grep -q "^AIza"; then
          echo "✅ Formato correto! Começa com 'AIza'"
        else
          echo "❌ Formato incorreto! Deve começar com 'AIza'"
          echo "🔑 Formato atual: ${GOOGLE_API_KEY:0:4}..."
          exit 1
        fi
      env:
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
